<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Freezing bucket · ClimaSeaIce.jl</title><meta name="title" content="Freezing bucket · ClimaSeaIce.jl"/><meta property="og:title" content="Freezing bucket · ClimaSeaIce.jl"/><meta property="twitter:title" content="Freezing bucket · ClimaSeaIce.jl"/><meta name="description" content="Documentation for ClimaSeaIce.jl."/><meta property="og:description" content="Documentation for ClimaSeaIce.jl."/><meta property="twitter:description" content="Documentation for ClimaSeaIce.jl."/><meta property="og:url" content="https://clima.github.io/ClimaSeaIceDocumentation/dev/literated/freezing_bucket/"/><meta property="twitter:url" content="https://clima.github.io/ClimaSeaIceDocumentation/dev/literated/freezing_bucket/"/><link rel="canonical" href="https://clima.github.io/ClimaSeaIceDocumentation/dev/literated/freezing_bucket/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ClimaSeaIce.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Freezing bucket</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#An-infinitely-deep-bucket-with-a-single-grid-point"><span>An infinitely deep bucket with a single grid point</span></a></li><li class="toplevel"><a class="tocitem" href="#Collecting-data-and-running-the-simulation"><span>Collecting data and running the simulation</span></a></li><li class="toplevel"><a class="tocitem" href="#Visualizing-the-result"><span>Visualizing the result</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/outline/">Contents</a></li><li><a class="tocitem" href="../../library/public/">Public</a></li><li><a class="tocitem" href="../../library/internals/">Private</a></li><li><a class="tocitem" href="../../library/function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Freezing bucket</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Freezing bucket</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaSeaIce.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaSeaIce.jl/blob/main/examples/freezing_bucket.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="A-freezing-bucket"><a class="docs-heading-anchor" href="#A-freezing-bucket">A freezing bucket</a><a id="A-freezing-bucket-1"></a><a class="docs-heading-anchor-permalink" href="#A-freezing-bucket" title="Permalink"></a></h1><p>A common laboratory experiment freezes an insultated bucket of water from the top down, using a metal lid to keep the top of the bucket at some constant, very cold temperature. In this example, we simulate such a scenario using <code>SlabSeaIceModel</code>. Here, the bucket is perfectly insulated and infinitely deep, like many buckets are: if the <code>Simulation</code> is run for longer, the ice will keep freezing, and freezing, and will never run out of water. Also, the water in the infinite bucket is (somehow) all at the same temperature, in equilibrium with the ice-water interface (and therefore fixed at the melting temperature). Yep, this kind of thing happens <em>all the time</em>.</p><p>We start by <code>using Oceananigans</code> to bring in functions for building grids and <code>Simulation</code>s and the like.</p><pre><code class="language-julia hljs">using Oceananigans
using Oceananigans.Units</code></pre><p>Next we <code>using ClimaSeaIce</code> to get some ice-specific names.</p><pre><code class="language-julia hljs">using ClimaSeaIce</code></pre><h1 id="An-infinitely-deep-bucket-with-a-single-grid-point"><a class="docs-heading-anchor" href="#An-infinitely-deep-bucket-with-a-single-grid-point">An infinitely deep bucket with a single grid point</a><a id="An-infinitely-deep-bucket-with-a-single-grid-point-1"></a><a class="docs-heading-anchor-permalink" href="#An-infinitely-deep-bucket-with-a-single-grid-point" title="Permalink"></a></h1><p>Perhaps surprisingly, we need just one grid point to model an possibly infinitely thick slab of ice with <code>SlabSeaIceModel</code>. We would only need more than 1 grid point if our boundary conditions vary in the horizontal direction.</p><pre><code class="language-julia hljs">grid = RectilinearGrid(size=(), topology=(Flat, Flat, Flat))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1×1×1 RectilinearGrid{Float64, Oceananigans.Grids.Flat, Oceananigans.Grids.Flat, Oceananigans.Grids.Flat} on Oceananigans.Architectures.CPU with 0×0×0 halo
├── Flat x
├── Flat y
└── Flat z</code></pre><p>Next, we build our model of an ice slab freezing into a bucket. We start by defining a constant internal <code>ConductiveFlux</code> with ice_conductivity</p><pre><code class="language-julia hljs">conductivity = 2 # kg m s⁻³ K⁻¹
internal_heat_flux = ConductiveFlux(; conductivity)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConductiveFlux{Float64}(2.0)</code></pre><p>Note that other units besides Celsius <em>can</em> be used, but that requires setting model.phase_transitions` with appropriate parameters. We set the ice heat capacity and density as well,</p><pre><code class="language-julia hljs">ice_heat_capacity = 2100 # J kg⁻¹ K⁻¹
ice_density = 900 # kg m⁻³
phase_transitions = PhaseTransitions(; ice_heat_capacity, ice_density)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PhaseTransitions{Float64, ClimaSeaIce.SeaIceThermodynamics.LinearLiquidus{Float64}}(900.0, 2100.0, 999.8, 4186.0, 334000.0, 0.0, ClimaSeaIce.SeaIceThermodynamics.LinearLiquidus{Float64}(0.0, 0.054))</code></pre><p>We set the top ice temperature,</p><pre><code class="language-julia hljs">top_temperature = -10 # ᵒC
top_heat_boundary_condition = PrescribedTemperature(-10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PrescribedTemperature{Int64}(-10)</code></pre><p>Construct the thermodynamics of sea ice, for this we use a simple slab sea ice representation of thermodynamics</p><pre><code class="language-julia hljs">ice_thermodynamics = SlabSeaIceThermodynamics(grid;
                                              internal_heat_flux,
                                              phase_transitions,
                                              top_heat_boundary_condition)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SlabSeaIceThermodynamics
├── top_surface_temperature: ConstantField(-10)
└── minimium_ice_thickness: ConstantField(0.0)
</code></pre><p>Then we assemble it all into a model,</p><pre><code class="language-julia hljs">model = SeaIceModel(grid; ice_thermodynamics)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SeaIceModel{Oceananigans.Architectures.CPU, Oceananigans.Grids.RectilinearGrid}(time = 0 seconds, iteration = 0)
├── grid: 1×1×1 RectilinearGrid{Float64, Oceananigans.Grids.Flat, Oceananigans.Grids.Flat, Oceananigans.Grids.Flat} on Oceananigans.Architectures.CPU with 0×0×0 halo
├── ice thermodynamics: SlabThermodynamics
├── advection: Nothing
└── external_heat_fluxes: 
    ├── top: FluxFunction of slab_internal_heat_flux with parameters (flux=ConductiveFlux{Float64}, liquidus=ClimaSeaIce.SeaIceThermodynamics.LinearLiquidus{Float64}, bottom_heat_boundary_condition=ClimaSeaIce.SeaIceThermodynamics.HeatBoundaryConditions.IceWaterThermalEquilibrium{Int64})
    └── bottom: 0</code></pre><p>Note that the default bottom heat boundary condition for <code>SlabSeaIceThermodynamics</code> is <code>IceWaterThermalEquilibrium</code> with freshwater. That&#39;s what we want!</p><pre><code class="language-julia hljs">model.ice_thermodynamics.heat_boundary_conditions.bottom</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ClimaSeaIce.SeaIceThermodynamics.HeatBoundaryConditions.IceWaterThermalEquilibrium{Int64}(0)</code></pre><p>Ok, we&#39;re ready to freeze the bucket for 10 straight days with an initial ice thickness of 1 cm,</p><pre><code class="language-julia hljs">simulation = Simulation(model, Δt=10minute, stop_time=10days)

set!(model, h=0.01)</code></pre><h1 id="Collecting-data-and-running-the-simulation"><a class="docs-heading-anchor" href="#Collecting-data-and-running-the-simulation">Collecting data and running the simulation</a><a id="Collecting-data-and-running-the-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Collecting-data-and-running-the-simulation" title="Permalink"></a></h1><p>Before simulating the freezing bucket, we set up a <code>Callback</code> to create a timeseries of the ice thickness saved at every time step.</p><pre><code class="language-julia hljs"># Container to hold the data
timeseries = []

# Callback function to collect the data from the `sim`ulation
function accumulate_timeseries(sim)
    h = sim.model.ice_thickness
    push!(timeseries, (time(sim), first(h)))
end

# Add the callback to `simulation`
simulation.callbacks[:save] = Callback(accumulate_timeseries)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Callback of accumulate_timeseries on IterationInterval(1)</code></pre><p>Now we&#39;re ready to hit the Big Red Button (it should run pretty quick):</p><pre><code class="language-julia hljs">run!(simulation)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Initializing simulation...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... simulation initialization complete (478.951 ms)
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Executing initial time step...
<span class="sgr36"><span class="sgr1">[ Info: </span></span>    ... initial time step complete (471.118 ms).
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Simulation is stopping after running for 1.007 seconds.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Simulation time 10 days equals or exceeds stop time 10 days.</code></pre><h1 id="Visualizing-the-result"><a class="docs-heading-anchor" href="#Visualizing-the-result">Visualizing the result</a><a id="Visualizing-the-result-1"></a><a class="docs-heading-anchor-permalink" href="#Visualizing-the-result" title="Permalink"></a></h1><p>It&#39;d be a shame to run such a &quot;cool&quot; simulation without looking at the results. We&#39;ll visualize it with Makie.</p><pre><code class="language-julia hljs">using CairoMakie</code></pre><p><code>timeseries</code> is a <code>Vector</code> of <code>Tuple</code>. So we have to do a bit of processing to build <code>Vector</code>s of time <code>t</code> and thickness <code>h</code>. It&#39;s not much work though:</p><pre><code class="language-julia hljs">t = [datum[1] for datum in timeseries]
h = [datum[2] for datum in timeseries]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1441-element Vector{Float64}:
 0.01
 0.01359353307787306
 0.01623709384848865
 0.018450256568002983
 0.02039794388857124
 0.02215965727375536
 0.023781312804560452
 0.025292387112108326
 0.026713183441827916
 0.028058411757913317
 ⋮
 0.32116543894477484
 0.32127732934897524
 0.3213891807854011
 0.3215009932947423
 0.32161276691761814
 0.3217245016945772
 0.3218361976660977
 0.32194785487258765
 0.3220594733543848</code></pre><p>Just for fun, we also compute the velocity of the ice-water interface:</p><pre><code class="language-julia hljs">dhdt = @. (h[2:end] - h[1:end-1]) / simulation.Δt</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1440-element Vector{Float64}:
 5.9892217964551e-6
 4.405934617692647e-6
 3.6886045325238912e-6
 3.2461455342804267e-6
 2.9361889753068706e-6
 2.702759218008484e-6
 2.5184571792464564e-6
 2.367993882865984e-6
 2.242047193475669e-6
 2.134554816619639e-6
 ⋮
 1.8654902122651936e-7
 1.864840070006646e-7
 1.8641906070972676e-7
 1.8635418223537463e-7
 1.862893714597395e-7
 1.862246282651377e-7
 1.861599525341632e-7
 1.860953441498725e-7
 1.8603080299522957e-7</code></pre><p>All that&#39;s left, really, is to put those <code>lines!</code> in an <code>Axis</code>:</p><pre><code class="language-julia hljs">set_theme!(Theme(fontsize=24, linewidth=4))

fig = Figure(size=(1200, 600))

axh = Axis(fig[1, 1], xlabel=&quot;Time (days)&quot;, ylabel=&quot;Ice thickness (cm)&quot;)
axd = Axis(fig[1, 2], xlabel=&quot;Ice thickness (cm)&quot;, ylabel=&quot;Freezing rate (μm s⁻¹)&quot;)

lines!(axh, t ./ day, 1e2 .* h)
lines!(axd, 1e2 .* h[1:end-1], 1e6 .* dhdt)

fig</code></pre><img src="a6aea79d.png" alt="Example block output"/><p>If you want more ice, you can increase <code>simulation.stop_time</code> and <code>run!(simulation)</code> again (or just re-run the whole script).</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../../library/outline/">Contents »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Saturday 26 October 2024 19:24">Saturday 26 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
